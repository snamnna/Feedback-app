<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Client/src/Pages/CourseDetails/CourseDetails.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Client/src/Pages/CourseDetails/CourseDetails.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module Client/CourseDetails
 * @file React component for displaying details of a course.
 * @exports CourseDetails
 */

import React, { useEffect, useState } from "react";
import { useGetCourseByIdQuery } from "../../features/courseApi";
import { useParams } from "react-router";
import PropTypes from "prop-types";
import LectureCard from "./components/LectureCard";
import { useDispatch, useSelector } from "react-redux";
import courseService from "../../services/courseService";
import { selectCourse } from "../../features/courses/courseSlice";
import DropdownMenu from "./components/DropdownMenu";
import OverViewTab from "./components/OverViewTab";
import ParticipantsTab from "./components/ParticipantsTab";
import EnrollmentTab from "./components/EnrollmentTab";
import { useNavigate } from "react-router-dom";
import feedbackService from "../../services/feedbackService";

/**
 * @function CourseDetails
 * @description React component for displaying details of a course.
 */
const CourseDetails = () => {
  const { courseId } = useParams();
  const [course, setCourse] = useState({});
  const [search, setSearch] = useState("");
  const token = useSelector((state) => state.auth.token);
  const userId = useSelector((state) => state.auth.user.id);
  const [lectures, setLectures] = useState([]);
  const { data, error, isLoading } = useGetCourseByIdQuery(courseId);
  const [isOwner, setIsOwner] = useState(false);
  const dispatch = useDispatch();
  const [active, setActive] = useState("le");
  const [enrollmentStatus, setEnrollmentStatus] = useState("");
  const [enrollBtn, setEnrollBtn] = useState(true);
  const navigate = useNavigate();
  const [enrollments, setEnrollments] = useState([]);

  /**
   * @description useEffect hook to fetch and set the necessary data for the component.
   * Sets the course, lectures, enrollments, and enrollment status.
   * Checks if the user is the owner of the course.
   */
  useEffect(() => {
    if (data) {
      console.log(data);
      const { course, enrollment } = data;
      setCourse(course);
      setLectures(course.lectures);
      setEnrollments(course.enrollments);
      dispatch(selectCourse(course));

      if (enrollment) {
        console.log(enrollment.status);
        setEnrollmentStatus(enrollment.status);
      } else {
        console.log("enrollmentStatus is null ");
        setEnrollmentStatus("");
      }

      // Set isOwner to true if user is the owner of the course
      if (course.lecturerId === userId) {
        setIsOwner(true);
      }
    }
  }, [data]);

  /**
   * @description A function to handle the enrollment process for a course.
   */
  const handleEnroll = async () => {
    const data = {
      courseId,
    };
    const enroll = await courseService.courseEnrollment(data, token);
    if (enroll) {
      console.log("enrollment success");
      setEnrollBtn(false);
    }
  };

  /**
   * @description A function to filter lectures based on a search query.
   * @param {Array} lectures - An array of lectures to filter.
   * @param {string} search - The search query to filter lectures.
   * @returns {Array} Filtered array of lectures.
   */
  const filterLectures = lectures.filter((lecture) =>
    lecture.name.toLowerCase().includes(search.toLowerCase())
  );

  /**
   * @description A function to handle the process of leaving a course.
   */
  const handleLeave = async () => {
    try {
      const data = {
        courseId,
        userId,
        status: "REJECTED",
      };
      const response = await courseService.acceptEnrollment(data, token);

      setEnrollBtn(true);
      console.log("Left the course:", response);
    } catch (error) {
      console.error("Leaving the course failed:", error);
    }
  };

  /**
   * @description A function to handle the deletion of a course.
   */
  const handleDelete = async () => {
    // Check if there is feedback
    const courseFeedbackExists = await feedbackService.courseFeedback(
      courseId,
      token
    );

    console.log("haetaan feedbackit jos on" + courseFeedbackExists);

    // If feedback, alert and return
    if (courseFeedbackExists.length > 0) {
      alert("Cannot delete course with existing feedback");
      return;
    }

    const deleteCourse = await courseService.deleteCourse(courseId, token);
    console.log(deleteCourse);
    navigate("/");
  };

  /**
   * React component for displaying details of a course when enrollment is approved.
   */
  if (enrollmentStatus === "APPROVED") {
    return (
      &lt;div className="">
        &lt;div className="flex justify-between px-10 py-3 bg-base-100 ">
          &lt;div className="flex flex-row ">
            &lt;h1 className="my-2 text-xl font-bold">
              Details for {course.name}
            &lt;/h1>
            {!isOwner &amp;&amp; enrollmentStatus === "APPROVED" &amp;&amp; (
              &lt;button
                id="leaveCourse"
                className="ml-2 mt-1 btn btn-primary btn-sm"
                onClick={() => handleLeave()}
              >
                Leave the course
              &lt;/button>
            )}
            {isOwner ? (
              &lt;>
                &lt;DropdownMenu
                  onAddLecture={() =>
                    document.getElementById("new_lecture_modal").showModal()
                  }
                  onEditCourse={() =>
                    document.getElementById("edit_course_modal").showModal()
                  }
                  onDeleteCourse={() => handleDelete()}
                />
                &lt;div className=" mb-3 tabs">
                  &lt;a
                    onClick={() => setActive("le")}
                    className={`tab ${active === "le" ? "tab-active " : ""}`}
                  >
                    Lectures
                  &lt;/a>
                  &lt;a
                    onClick={() => setActive("ow")}
                    className={`tab ${active === "ow" ? "tab-active" : ""}`}
                  >
                    Feedback
                  &lt;/a>
                  &lt;a
                    onClick={() => setActive("pa")}
                    className={`tab ${active === "pa" ? "tab-active" : ""}`}
                  >
                    Participants
                  &lt;/a>
                  &lt;a
                    onClick={() => setActive("en")}
                    className={`tab ${active === "en" ? "tab-active" : ""}`}
                  >
                    Enrollments
                  &lt;/a>
                &lt;/div>
              &lt;/>
            ) : (
              &lt;>&lt;/>
            )}
          &lt;/div>
          {!isOwner &amp;&amp; (
            &lt;div>
              &lt;input
                className="border border-gray-300 shadow-md rounded-md ml-2"
                type="text"
                placeholder="Search Lectures"
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            &lt;/div>
          )}
          {isOwner &amp;&amp; active === "le" &amp;&amp; (
            &lt;div>
              &lt;input
                className=" border border-gray-300 shadow-md rounded-md"
                type="text"
                placeholder="Search Lectures"
                value={search}
                onChange={(e) => setSearch(e.target.value)}
              />
            &lt;/div>
          )}
        &lt;/div>
        {isOwner &amp;&amp; active === "le" &amp;&amp; (
          &lt;div className="flex justify-center max-w-full">
            &lt;LectureList lectures={filterLectures} isOwner={isOwner} />
          &lt;/div>
        )}
        {!isOwner &amp;&amp; (
          &lt;div className="flex w-2xl ">
            &lt;LectureList lectures={filterLectures} isOwner={isOwner} />
          &lt;/div>
        )}
        {/* Overview active */}
        {isOwner &amp;&amp; active === "ow" &amp;&amp; &lt;OverViewTab />}
        {/* Participants tab active */}
        {isOwner &amp;&amp; active === "pa" &amp;&amp; &lt;ParticipantsTab />}
        {/* Enroll tab active */}
        {isOwner &amp;&amp; active === "en" &amp;&amp; &lt;EnrollmentTab />}
      &lt;/div>
    );
  }
  /**
   * React component for displaying details when the user is not yet enrolled in the course.
   */
  return (
    &lt;div className="flex justify-center max-w-screen">
      &lt;div className="my-10 max-w-xl border rounded-md py-10 px-16 text-center">
        &lt;p className="text-lg">You are not yet enrolled in course&lt;/p>
        &lt;h1 className=" text-2xl font-bold">{course.name}&lt;/h1>
        &lt;h2 className="text-md font-bold">Description:&lt;/h2>
        &lt;p className="italic">{course.description}&lt;/p>
        &lt;button
          onClick={() => handleEnroll()}
          id="req-btn"
          className="btn btn-primary my-2"
          disabled={!enrollBtn}
        >
          Request to join the course
        &lt;/button>
      &lt;/div>
    &lt;/div>
  );
};

/**
 * @description React component for displaying a list of lectures.
 * @param {Object} props - Component props.
 * @param {Array} props.lectures - Array of lectures to be displayed.
 * @returns {JSX.Element} Rendered component.
 */
const LectureList = ({ lectures }) => {
  const course = useSelector((state) => state.courses.selectedCourse);
  const userId = useSelector((state) => state.auth.user.id);
  const [isOwner, setIsOwner] = useState(false);

  /**
   * useEffect hook to determine if the current user is the owner of the course.
   */
  useEffect(() => {
    if (course.lecturerId === userId) {
      setIsOwner(true);
    } else {
      setIsOwner(false);
    }
  }, [course.lecturerId, userId]);

  /**
   * Rendered component based on the condition of the user having lectures or not.
   */
  if (lectures.length > 0) {
    return (
      &lt;div className="">
        &lt;h1 className="text-center font-bold">Lectures:&lt;/h1>
        &lt;div className="flex justify-center items-center w-screen ">
          &lt;ul className="mt-3 mb-5">
            {lectures.map((lecture) => (
              &lt;li className="mx-10 w-full" key={lecture.id}>
                &lt;LectureCard lecture={lecture} />
              &lt;/li>
            ))}
          &lt;/ul>
        &lt;/div>
      &lt;/div>
    );
  }

  /**
   * Rendered component when there are no lectures.
   */
  return (
    &lt;div className="flex justify-center items-center w-screen my-20">
      &lt;div className="mx-auto border py-7 px-10 rounded-md text-center">
        &lt;p>No lectures yet&lt;/p>
        {isOwner &amp;&amp; (
          &lt;button
            className="btn btn-sm btn-primary mt-3"
            onClick={() =>
              document.getElementById("new_lecture_modal").showModal()
            }
          >
            New lecture
          &lt;/button>
        )}
      &lt;/div>
    &lt;/div>
  );
};

/**
 * PropTypes for the LectureList component.
 * @property {Array} lectures - An array of lectures, each having an id and name.
 */
LectureList.propTypes = {
  lectures: PropTypes.arrayOf(
    PropTypes.shape({
      id: PropTypes.number.isRequired,
      name: PropTypes.string.isRequired,
    })
  ),
};

export default CourseDetails;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="Client_src_Pages_CourseDetails_CourseDetails.module_jsx.html">Client/src/Pages/CourseDetails/CourseDetails.jsx</a></li><li><a href="module-Client_courseService.html">Client/courseService</a></li><li><a href="module-Client_courseSlice.html">Client/courseSlice</a></li><li><a href="module-server_courseController.html">server/courseController</a></li><li><a href="module-server_courseService.html">server/courseService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Dec 10 2023 00:06:40 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
